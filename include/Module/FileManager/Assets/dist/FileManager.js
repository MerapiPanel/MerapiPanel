(()=>{"use strict";var e={710:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=new WeakMap,o=new WeakMap;function a(e){const t=n.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function i(e,t){n.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const o=Object.keys(t);for(let e=0;e<o.length;++e){const t=o[e];t in this||Object.defineProperty(this,t,r(t))}}function r(e){return{get(){return a(this).event[e]},set(t){a(this).event[e]=t},configurable:!0,enumerable:!0}}function s(e){return{value(){const t=a(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function l(e){if(null==e||e===Object.prototype)return i;let t=o.get(e);return null==t&&(t=function(e,t){const n=Object.keys(t);if(0===n.length)return e;function o(t,n){e.call(this,t,n)}o.prototype=Object.create(e.prototype,{constructor:{value:o,configurable:!0,writable:!0}});for(let a=0;a<n.length;++a){const i=n[a];if(!(i in e.prototype)){const e="function"==typeof Object.getOwnPropertyDescriptor(t,i).value;Object.defineProperty(o.prototype,i,e?s(i):r(i))}}return o}(l(Object.getPrototypeOf(e)),e),o.set(e,t)),t}function c(e){return a(e).stopped}function d(e,t){a(e).passiveListener=t}i.prototype={get type(){return a(this).event.type},get target(){return a(this).eventTarget},get currentTarget(){return a(this).currentTarget},composedPath(){const e=a(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return a(this).eventPhase},stopPropagation(){const e=a(this);"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation(){const e=a(this);e.stopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(a(this).event.bubbles)},get cancelable(){return Boolean(a(this).event.cancelable)},preventDefault(){const e=a(this);null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):console.warn("Event#preventDefault() was called from a passive listener:",e.passiveListener)},get defaultPrevented(){return a(this).canceled},get composed(){return Boolean(a(this).event.composed)},get timeStamp(){return a(this).timeStamp}},Object.defineProperty(i.prototype,"constructor",{value:i,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(i.prototype,window.Event.prototype),o.set(window.Event.prototype,i));const p=new WeakMap,u=3;function f(e){return null!==e&&"object"==typeof e}function h(e){const t=p.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function g(e,t){Object.defineProperty(e,`on${t}`,function(e){return{get(){let t=h(this).get(e);for(;null!=t;){if(t.listenerType===u)return t.listener;t=t.next}return null},set(t){"function"==typeof t||f(t)||(t=null);const n=h(this);let o=null,a=n.get(e);for(;null!=a;)a.listenerType===u?null!==o?o.next=a.next:null!==a.next?n.set(e,a.next):n.delete(e):o=a,a=a.next;if(null!==t){const a={listener:t,listenerType:u,passive:!1,once:!1,next:null};null===o?n.set(e,a):o.next=a}},configurable:!0,enumerable:!0}}(t))}function m(e){function t(){v.call(this)}t.prototype=Object.create(v.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let n=0;n<e.length;++n)g(t.prototype,e[n]);return t}function v(){if(!(this instanceof v)){if(1===arguments.length&&Array.isArray(arguments[0]))return m(arguments[0]);if(arguments.length>0){const e=new Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return m(e)}throw new TypeError("Cannot call a class as a function")}p.set(this,new Map)}v.prototype={addEventListener(e,t,n){if(null==t)return!1;if("function"!=typeof t&&!f(t))throw new TypeError("'listener' should be a function or an object.");const o=h(this),a=f(n),i=(a?Boolean(n.capture):Boolean(n))?1:2,r={listener:t,listenerType:i,passive:a&&Boolean(n.passive),once:a&&Boolean(n.once),next:null};let s=o.get(e);if(void 0===s)return o.set(e,r),!0;let l=null;for(;null!=s;){if(s.listener===t&&s.listenerType===i)return!1;l=s,s=s.next}return l.next=r,!0},removeEventListener(e,t,n){if(null==t)return!1;const o=h(this),a=(f(n)?Boolean(n.capture):Boolean(n))?1:2;let i=null,r=o.get(e);for(;null!=r;){if(r.listener===t&&r.listenerType===a)return null!==i?i.next=r.next:null!==r.next?o.set(e,r.next):o.delete(e),!0;i=r,r=r.next}return!1},dispatchEvent(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');const t=h(this),n=e.type;let o=t.get(n);if(null==o)return!0;const i=function(e,t){return new(l(Object.getPrototypeOf(t)))(e,t)}(this,e);let r=null;for(;null!=o;){if(o.once?null!==r?r.next=o.next:null!==o.next?t.set(n,o.next):t.delete(n):r=o,d(i,o.passive?o.listener:null),"function"==typeof o.listener)try{o.listener.call(this,i)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else o.listenerType!==u&&"function"==typeof o.listener.handleEvent&&o.listener.handleEvent(i);if(c(i))break;o=o.next}return d(i,null),function(e,t){a(e).eventPhase=0}(i),function(e,t){a(e).currentTarget=null}(i),!i.defaultPrevented}},Object.defineProperty(v.prototype,"constructor",{value:v,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(v.prototype,window.EventTarget.prototype),t.defineEventAttribute=g,t.EventTarget=v,t.default=v,e.exports=v,e.exports.EventTarget=e.exports.default=v,e.exports.defineEventAttribute=g}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}(()=>{var e=n(710);const t=class{constructor(t){this.endpoint=t.endpoint,this.file=t.file,this.headers=t.headers||{},this.postParams=t.postParams,this.chunkSize=t.chunkSize||10,this.retries=t.retries||5,this.delayBeforeRetry=t.delayBeforeRetry||5,this.start=0,this.chunk=null,this.chunkCount=0,this.totalChunks=Math.ceil(this.file.size/(1e3*this.chunkSize*1e3)),this.retriesCount=0,this.offline=!1,this.paused=!1,this.headers["uploader-file-id"]=this._uniqid(this.file),this.headers["uploader-chunks-total"]=this.totalChunks,this._reader=new FileReader,this._eventTarget=new e.EventTarget,this._validateParams(),this._sendChunks(),window.addEventListener("online",(()=>{this.offline&&(this.offline=!1,this._eventTarget.dispatchEvent(new Event("online")),this._sendChunks())})),window.addEventListener("offline",(()=>{this.offline=!0,this._eventTarget.dispatchEvent(new Event("offline"))}))}on(e,t){this._eventTarget.addEventListener(e,t)}_validateParams(){if(!this.endpoint||!this.endpoint.length)throw new TypeError("endpoint must be defined");if(this.file instanceof File==0)throw new TypeError("file must be a File object");if(this.headers&&"object"!=typeof this.headers)throw new TypeError("headers must be null or an object");if(this.postParams&&"object"!=typeof this.postParams)throw new TypeError("postParams must be null or an object");if(this.chunkSize&&("number"!=typeof this.chunkSize||0===this.chunkSize))throw new TypeError("chunkSize must be a positive number");if(this.retries&&("number"!=typeof this.retries||0===this.retries))throw new TypeError("retries must be a positive number");if(this.delayBeforeRetry&&"number"!=typeof this.delayBeforeRetry)throw new TypeError("delayBeforeRetry must be a positive number")}_uniqid(){return Math.floor(1e8*Math.random())+Date.now()+this.file.size}_getChunk(){return new Promise((e=>{const t=1===this.totalChunks?this.file.size:1e3*this.chunkSize*1e3,n=t*this.chunkCount;this._reader.onload=()=>{this.chunk=new Blob([this._reader.result],{type:"application/octet-stream"}),e()},this._reader.readAsArrayBuffer(this.file.slice(n,n+t))}))}_sendChunk(){const e=new FormData;return this.chunkCount+1===this.totalChunks&&this.postParams&&Object.keys(this.postParams).forEach((t=>e.append(t,this.postParams[t]))),e.append("file",this.chunk),this.headers["uploader-chunk-number"]=this.chunkCount,fetch(this.endpoint,{method:"POST",headers:this.headers,body:e})}_manageRetries(){if(this.retriesCount++<this.retries)return setTimeout((()=>this._sendChunks()),1e3*this.delayBeforeRetry),void this._eventTarget.dispatchEvent(new CustomEvent("fileRetry",{detail:{message:`An error occured uploading chunk ${this.chunkCount}. ${this.retries-this.retriesCount} retries left`,chunk:this.chunkCount,retriesLeft:this.retries-this.retriesCount}}));this._eventTarget.dispatchEvent(new CustomEvent("error",{detail:`An error occured uploading chunk ${this.chunkCount}. No more retries, stopping upload`}))}_sendChunks(){this.paused||this.offline||this._getChunk().then((()=>this._sendChunk())).then((e=>{if(200===e.status||201===e.status||204===e.status){++this.chunkCount<this.totalChunks?this._sendChunks():this._eventTarget.dispatchEvent(new Event("finish"));const e=Math.round(100/this.totalChunks*this.chunkCount);this._eventTarget.dispatchEvent(new CustomEvent("progress",{detail:e}))}else if([408,502,503,504].includes(e.status)){if(this.paused||this.offline)return;this._manageRetries()}else{if(this.paused||this.offline)return;this._eventTarget.dispatchEvent(new CustomEvent("error",{detail:`Server responded with ${e.status}. Stopping upload`}))}})).catch((e=>{this.paused||this.offline||this._manageRetries()}))}togglePause(){this.paused=!this.paused,this.paused||this._sendChunks()}};function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){var a,i,r,s;a=e,i=t,r=n[t],s=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!=o(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i),(i="symbol"==o(s)?s:s+"")in a?Object.defineProperty(a,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[i]=r})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=window.__,c=l.FileManager;function d(e,t){for(var n=c.assets,o=n,a=(e||"").replace(/^\//,"").split("/").filter((function(e){return""!==e})),i=0;i<a.length;i++){var r=a[i];if(i===a.length-1){if(n[r]){var l=n[r].children||{};l[a[i]]=t,n[r].children=l}else n[r]=s(s({},{children:{}}),t);o.children_count+=1}else n[r]||(n[r]={name:r,path:a.slice(0,i+1).join("/"),type:"folder",children:{},children_count:0,time:Date.now()},o.invalid=!0),o=n[r],n=n[r].children}return!0}c.Modal="CreateProperty",c.AssetView="CreateProperty",c.on("set:Modal",(function(e){throw new Error("Error: Can't change FileManager object")})),c.on("set:endpoints",(function(e){throw new Error("Error: Can't change FileManager object")})),c.config=s(s({},{enable_select_folder:!0,enable_upload:!0,enable_create_folder:!0,enable_delete:!0,enable_rename:!0,enable_download:!0,enable_view:!0,extensions:["img","jpeg","jpg","png","gif","svg","webp"]}),c.config),c.roles=s(s({},{upload:!1,modify:!1}),c.roles),c.uploadInfo=function(e){return new Promise((function(t,n){l.http.post(c.endpoints.uploadInfo,{id:e}).then((function(e){t(e.data)})).catch(n)}))},c.uploadHandler=function(e,n){var o,r;if(c.roles.upload){c.fire("upload",e),(o=c.upload_files).push.apply(o,function(e){if(Array.isArray(e))return i(e)}(r=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||a(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),window.onbeforeunload=function(e){return"Upload is in progress. Are you sure you want to leave?"};for(var s,d=function(o){var a=e[o],i=$("<div class='card rounded-3 shadow-sm border-0'>").append($('<small class="text-muted p-1 pb-0 d-inline-block file-name text-break" >'.concat(e[o].name,"</small>")).append($('<span class="text-muted p-1 d-inline-block fw-semibold file-size" >'.concat((a.size/1024/1024).toFixed(2)," MB</span>")))).append(a.folder?"<small class='d-block text-muted p-1 pt-0 mb-1' style=\"font-size: 0.7em\">folder: ".concat(a.folder||"/","</small>"):"").append($('<div class="d-flex align-items-end">').append($('<div class="progress rounded-0 flex-grow-1" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">').css("height","19px").append('<div class="progress-bar rounded-0" style="width: 5%">5%</div>'),$('<button type="button" class="btn btn-sm btn-warning py-0 px-1 rounded-0 ms-1">Pause</button>')));n.prepend(i);var r=c.endpoints.upload;if(!r)return l.toast("Error: Please set FileManager.endpoints.upload",5,"text-danger"),{v:void 0};var s=new t({endpoint:r,file:e[o],headers:{"uploader-file-name":e[o].name,"uploader-file-folder":a.folder,"uploader-file-size":e[o].size},chunkSize:2}),d=i.find(".btn"),p=i.find(".progress-bar");function u(){s.togglePause(),s.paused?(d.text("Resume").removeClass("btn-warning btn-success").addClass("btn-success"),p.removeClass("bg-danger bg-success progress-bar-striped progress-bar-animated").addClass("bg-warning")):(d.text("Pause").removeClass("btn-success btn-danger").addClass("btn-warning"),p.removeClass("bg-danger bg-success bg-warning").addClass("bg-primary progress-bar-striped progress-bar-animated")),d.off("click",u).off("click",f).on("click",u)}function f(){s.paused||u(),u()}i.find(".btn").on("click",u),s.on("error",(function(e){p.css("width","100%").text(e.detail).addClass("bg-danger").removeClass("bg-primary progress-bar-striped progress-bar-animated"),i.find(".file-name").removeClass("text-muted").addClass("text-danger"),i.find(".btn").off("click",u).text("Try Again").removeClass("btn-warning btn-success").addClass("btn-danger").on("click",f),l.toast(e.detail||a.name+" upload failed",5,"text-danger")})),s.on("progress",(function(e){p.removeClass("bg-danger bg-success bg-warning").addClass("bg-primary progress-bar-striped progress-bar-animated").css("width",e.detail+"%").text(e.detail+"%"),i.find(".file-name").removeClass("text-danger text-warning").addClass("text-muted"),s.paused&&(d.text("Resume").removeClass("btn-warning btn-success").addClass("btn-success"),p.removeClass("bg-danger bg-success progress-bar-striped progress-bar-animated").addClass("bg-warning")),100==e.detail&&(d.off("click",u).off("click",f).html('<span class="spinner-border spinner-border-sm" aria-hidden="true"></span> Loading...').removeClass("btn-warning btn-success").addClass("btn-primary"),p.html("Processing...").removeClass("bg-danger bg-success bg-warning progress-bar-striped progress-bar-animated").addClass("bg-primary"))})),s.on("finish",(function(t){c.uploadInfo(s.headers["uploader-file-id"]).then((function(e){c.fire("upload:finish",e)})).catch((function(e){l.toast(e.message||"Something went wrong",5,"text-danger")})),setTimeout((function(){p.css("width","100%").text("100%").addClass("bg-success").removeClass("bg-primary bg-danger bg-warning progress-bar-striped progress-bar-animated"),i.find(".file-name").removeClass("text-muted").addClass("text-success"),d.off("click",u).off("click",f).text("Remove").removeClass("btn-warning btn-danger btn-success").addClass("btn-primary").on("click",(function(){i.remove();var t=c.upload_files.indexOf(e[o]);t>-1&&c.upload_files.splice(t,1)})),l.toast(a.name+" uploaded successfully!",5,"text-success")}),400),setTimeout((function(){i.fadeOut({duration:3e3,complete:function(){i.remove();var t=c.upload_files.indexOf(e[o]);t>-1&&c.upload_files.splice(t,1)}})}),6e4)})),s.on("offline",(function(){l.toast("Network offline",5,"text-danger")}))},p=0;p<e.length;p++)if(s=d(p))return s.v}else l.toast("You don't have permission to upload files",5,"text-danger")},c.on("upload:finish",(function(e){e.length>0?$("#floating_button").find(".badge").text(e.length):(window.onbeforeunload=null,$("#floating_button").fadeOut({duration:1e3,complete:function(){return $("#floating_button").remove()}}))})),c.upload_files=[],c.upload=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(c.roles.upload){var t=null;c.selectedFolder&&(t=c.selectedFolder.path||null),!t&&c.config.enable_select_folder&&(t="/");var n=$("<div>").css({display:"flex",flexWrap:"wrap",flexDirection:"column",gap:"1rem"}).append($('<div id="upload">').css({position:"relative",flex:1,minHeight:"250px",minWidth:"250px",borderRadius:"5px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"10px",background:"#0389fff0",color:"#fff",opacity:.5}).append($('<div class="w-100">').css({position:"absolute",top:"10px",left:"10px"}).append(t?$('<h5 id="upload-path">').text("upload to: "+t):""),$("<div class='text-center'>").on("click",(function(){$('<input type="file" multiple>').on("input",(function(e){return c.upload(e.target.files,$("#upload-content"))})).trigger("click")})).on("drop",(function(e){e.preventDefault(),console.log(e)})).css({margin:"auto 0px",width:"100%",minHeight:"250px",display:"flex",justifyContent:"center",alignContent:"center",alignItems:"center",flexDirection:"column"}).append($('<svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16">\n                            <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>\n                            <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/>\n                        </svg>'),$('<h5 class="text-center mt-3">').text("Click or Drop Files Here")))).append($('<div class="d-flex flex-column gap-1" id="upload-content">')),o=$("#FileManagerUploadModal").length?l.modal.from($("#FileManagerUploadModal")):l.modal.create("Upload Files",n);if(o.el.prop("id","FileManagerUploadModal"),o.find(".modal-footer").remove(),o.show(),e.length>0){for(var a=0;a<e.length;a++)e[a].folder=t;c.uploadHandler(e,$(o.el).find("#upload-content"))}o.off("modal:hide",i),o.on("modal:hide",i)}else l.toast("You don't have permission to upload files",5,"text-danger");function i(){if($("#floating_button").remove(),c.upload_files.length>0){var e=$('<button id="floating_button">').append('<i class="fa-solid fa-cloud-arrow-up fa-xl"></i>').append('<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">'.concat(c.upload_files.length,"</span>")).on("click",(function(){o.show(),e.remove()})).css({position:"fixed",bottom:"20px",right:"20px",background:"#2685ff",color:"#fff",border:"none",cursor:"pointer",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"2rem",padding:"1.5rem",boxShadow:"0 0 10px 0 rgba(0, 0, 0, 0.2)",zIndex:9999,transition:"1s",opacity:0,transform:"scale(5)"});$(document.body).append(e),setTimeout((function(){e.css({transform:"scale(1)",opacity:1})}),100)}}},c.delete=function(e){l.dialog.danger("Are you sure?",'<p>Are you sure you want to delete <span class="text-danger">'.concat(e.path,"</span>?</p>")).then((function(){var t=c.endpoints.delete;t||l.toast("Error: Please set FileManager.endpoints.delete",5,"text-danger"),l.http.post(t,{path:e.path}).then((function(t){l.toast("File deleted successfully",5,"text-success"),c.fire("delete",e),c.fire("delete:".concat(e.path),e)})).catch((function(e){l.toast(e.message,5,"text-danger")}))}))},c.rename=function(e){var t=$('<div class="form-group mb-3">').append($("<label>File Name</label>"),$('<input type="text" class="form-control" value="'.concat(e.name,'" />')));setTimeout((function(){t.find("input").focus()}),400),l.dialog.confirm("Rename "+e.name,t).then((function(){var n=t.find("input").val();if(n&&n.length>0){var o=c.endpoints.rename;o||l.toast("Error: Please set FileManager.endpoints.rename",5,"text-danger"),l.http.post(o,{path:e.path,name:n}).then((function(t){l.toast("File renamed successfully",5,"text-success"),c.fire("rename",e,n),c.fire("rename:".concat(e.path),e,n)})).catch((function(e){l.toast(e.message,5,"text-danger")}))}else l.toast("File name cannot be empty",5,"text-danger")}))},c.newFolder=function(e){var t=$('<div class="form-group mb-3">').append($("<label>Folder Name</label>"),$('<input type="text" class="form-control" />'));setTimeout((function(){t.find("input").focus()}),400),l.dialog.confirm("Create new folder",t).then((function(){var n=t.find("input").val();if(n&&n.length>0){var o=c.endpoints.newFolder;o||l.toast("Error: Please set FileManager.endpoints.newFolder",5,"text-danger"),l.http.post(o,{path:e.path,name:n}).then((function(t){l.toast("Folder created successfully",5,"text-success"),c.fire("newFolder",e,n),c.fire("newFolder:".concat(e.path),e,n)})).catch((function(e){l.toast(e.message,5,"text-danger")}))}else l.toast("Folder name cannot be empty",5,"text-danger")}))},c.assets={},c.selectedFolder=null,c.on("property:Modal",(function(e,t){var n={image:'<i class="fa-solid fa-image fa-xl"></i>',video:'<i class="fa-solid fa-video fa-xl"></i>',audio:'<i class="fa-solid fa-music fa-xl"></i>',document:'<i class="fa-solid fa-file fa-xl"></i>',other:'<i class="fa-solid fa-file fa-xl"></i>',folder:'<i class="fa-solid fa-folder fa-xl"></i>',file:'<i class="fa-solid fa-file fa-xl"></i>'};function o(e){return!!c.config.enable_select_folder&&!($(e.target).closest("#assets-content").length>0||$(e.target).closest(".file-asset").length>0||$(e.target).closest("#upload").length>0||$(e.target).closest("#FileManagerUploadModal").length>0)&&(c.selectedFolder="/",$("#FileManagerModal").find(".file-asset").css({backgroundColor:"transparent"}),void $("#FileManagerModal").find("#upload-path").text("upload to: /"))}function i(e,t){$("#FileManagerModal").find(".file-asset").css({backgroundColor:"transparent"}),$("#FileManagerModal").find("#"+r(t)).css({backgroundColor:"rgba(145, 209, 255, 0.1)"}),$("#FileManagerModal").find("#upload-path").text("upload to: ".concat(t.path.replace(/^[/]content/,""))),$("#FileManagerModal").off("click",o).on("click",o)}function r(e){return("asset-"+e.path.replace(/[^a-zA-Z0-9]/g,"-")).replace(/-+/g,"-")}function p(e,n){var o=n.file_folder,a=n.file_name,i=n.file_type;if(d(o.replace(/\/$/,"")+"/"+a,{name:a,path:o.replace(/\/$/,"")+"/"+a,type:i,children_count:0,time:(new Date).getTime()}))if(""==o.replace(/^[/]content\//,""))t.renderAsset($("#FileManagerModal").find("#assets-content"),"/");else{var r=o,s=$("#collapse-"+("asset-"+r.replace(/[^a-zA-Z0-9]/g,"-")).replace(/-+/g,"-"));if(s.length)t.renderAsset(s,o);else{for(;0==s.length;)r=r.replace(/\/[^\/]+$/,""),s=$("#collapse-"+("asset-"+r.replace(/[^a-zA-Z0-9]/g,"-")).replace(/-+/g,"-"));t.renderAsset(s,r)}}}function u(e,t){if(c.roles.modify){var o=c.config;if(0==o.enable_context_menu)return!1;if(!(o.enable_view||o.enable_rename||o.enable_new_folder||o.enable_download||o.enable_delete))return!1;$(".file-asset").removeClass("bg-primary bg-opacity-10"),$("#".concat(r(t))).addClass("bg-primary bg-opacity-10"),$("#filemanager-context-menu").remove();var a,i=$('<ul class="list-group list-group-flush" id="filemanager-context-menu">').append($('<li class="list-group-item fw-semibold px-3 py-2">'.concat(n[t.type]," /").concat((a=t.path.replace(/^[/]content\//,""),22,a.length>22?"..."+a.substring(a.length-22+3):a).replace(/^\//,""),"</li>")),"folder"!==t.type&&o.enable_view?$('<li class="list-group-item "><i class="fa-regular fa-folder-open"></i> Open</li>').on("mouseenter",(function(){$(this).addClass("bg-primary text-white")})).on("mouseleave",(function(){$(this).removeClass("bg-primary text-white")})).on("click",(function(){s(),c.AssetView.show(t)})):"","/"!=t.path&&o.enable_rename?$('<li class="list-group-item"><i class="fa-solid fa-pen-to-square"></i> Rename</li>').on("mouseenter",(function(){$(this).addClass("bg-primary text-white")})).on("mouseleave",(function(){$(this).removeClass("bg-primary text-white")})).on("click",(function(){s(),c.rename(t)})):"","folder"==t.type&&o.enable_new_folder?$('<li class="list-group-item"><i class="fa-solid fa-folder-plus"></i> Folder</li>').on("mouseenter",(function(){$(this).addClass("bg-primary text-white")})).on("mouseleave",(function(){$(this).removeClass("bg-primary text-white")})).on("click",(function(){s(),c.newFolder(t)})):"","folder"!==t.type&&o.enable_download?$('<li class="list-group-item"><i class="fa-solid fa-download"></i> Download</li>').on("mouseenter",(function(){$(this).addClass("bg-primary text-white")})).on("mouseleave",(function(){$(this).removeClass("bg-primary text-white")})).on("click",(function(){s(),$("<a>").prop("download",t.name).prop("target","_blank").attr("href",window.location.origin+t.path)[0].click()})):"","/"!=t.path&&o.enable_delete?$('<li class="list-group-item"><i class="fa-solid fa-trash"></i> Delete</li>').on("mouseenter",(function(){$(this).addClass("bg-danger text-white")})).on("mouseleave",(function(){$(this).removeClass("bg-danger text-white")})).on("click",(function(){s(),c.delete(t)})):"");i.css({position:"absolute",zIndex:600,left:e.pageX-200,top:e.pageY,boxShadow:"0 0 10px 0 rgba(0, 0, 0, 0.1)",cursor:"pointer",width:"100%",maxWidth:"200px"}).appendTo("body"),function(e){var t=e.getBoundingClientRect();if(!(t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth))){var n=t.left<0?0:t.right>window.innerWidth?window.innerWidth-t.width:t.left,o=t.top<0?0:t.bottom>window.innerHeight?window.innerHeight-t.height:t.top;e.style.left=n+"px",e.style.top=o+"px"}}(i[0]),$(document).on("click",l)}function s(){$("#filemanager-context-menu").remove(),$("#".concat(r(t))).removeClass("bg-primary bg-opacity-10"),$(document).off("click",l)}function l(e){$(e.target).closest("#filemanager-context-menu").length||s()}}function f(e,n,o){var a=n.path.split("/");a[a.length-1]=o,function(e,t){for(var n=!1,o=c.assets,a=(e.path||"").replace(/^\//,"").split("/").filter((function(e){return""!==e})),i=0;i<a.length;i++){var r=a[i];if(!o[r])break;if(i===a.length-1){var l=o[r].children||{};delete o[r],o[t.name]=s(s({},{children:l}),t),n=!0;break}o=o[r].children}return n}(n,{name:o,path:a.join("/"),type:n.type,children_count:n.children_count,time:n.time})&&t.renderAsset($("#FileManagerModal").find("#assets-content"),"/")}function h(e,t){(function(e){for(var t=!1,n=c.assets,o=n,a=(e.path||"").replace(/^\//,"").split("/").filter((function(e){return""!==e})),i=0;i<a.length;i++){var r=a[i];if(!n[r])break;if(i===a.length-1){delete n[r],o&&o.children_count&&(o.children_count-=1),t=!0;break}o=n[r],n=n[r].children}return t})(t)&&$("#".concat(r(t))).remove()}function g(e,n,o){var a={name:o,path:n.path.replace(/\/$/,"")+"/"+o+"/",type:"folder",children_count:0,time:Date.now()};if(d(n.path,a))if(""==n.path.replace(/^[/]content\//,""))t.renderAsset($("#FileManagerModal").find("#assets-content"),"/");else{var i="#collapse-"+r(n),s=$("#FileManagerModal").find(i);s.length&&t.renderAsset(s,n.path)}}t.show=function(){var e=$("<div>").css({display:"flex",flexWrap:"wrap",alignItems:"start",gap:"10px",minHeight:"400px"}).append(c.roles.upload&&c.config.enable_upload?$('<div id="upload">').css({position:"relative",flex:"1 1 300px",minHeight:"200px",width:"100%",border:"1px solid #eee",borderRadius:"5px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"10px",cursor:"pointer"}).append($('<div class="w-100">').append(c.config.enable_select_folder?$('<h5 id="upload-path">upload to: /</h5>'):$('<h5 id="upload-path"></h5>')),$("<div class='text-center'>").on("click",(function(){var e=$('<input type="file" multiple>').on("input",(function(e){e.target&&e.target.files&&c.upload(e.target.files)}));if(c.config.extensions){var t=[];Object.values(c.config.extensions).forEach((function(e){("string"==typeof e||e instanceof String)&&(e.startsWith(".")&&e.replace(/^./,""),t.push(e))})),e.attr("accept",t.join(", "))}e.trigger("click")})).on("drop",(function(e){e.preventDefault(),console.log(e)})).css({margin:"auto 0px",width:"100%",display:"flex",justifyContent:"center",alignContent:"center",alignItems:"center",flexDirection:"column"}).append($('<svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16">\n                                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>\n                                    <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/>\n                                </svg>'),$('<h5 class="text-center mt-3">').text("Click or Drop Files Here"))):"").append($('<div class="list-group list-group-flush" id="assets-content">').css({maxHeight:"65vh",overflow:"auto",flex:"1 1 300px",minHeight:"50vh"}).on("contextmenu",(function(e){e.preventDefault(),u(e,{type:"folder",path:"/",name:"root",time:(new Date).getTime()})}))),n=$("#FileManagerModal").length?l.modal.from($("#FileManagerModal")):l.modal.create("FileManager",e);n.el.prop("id","FileManagerModal"),n.el.find(".modal-dialog").css({maxWidth:"1024px"}),n.el.find(".modal-body").css({maxWidth:"1024px"}),n.el.find(".modal-footer").remove(),c.on("asset:select",(function(e){setTimeout((function(){$(document).find("#FileManagerModal").remove()}),100)})),n.show(),t.renderAsset($(n.el).find("#assets-content"),"/"),c.off("upload:finish",p),c.on("upload:finish",p)},t.renderAsset=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/";e.empty().append('<div class="text-center p-5"><i class="fa-solid fa-spinner fa-spin"></i></div>'),t.fetchAssets(n).then((function(n){e.empty().append(n.map((function(e){return t.createAssetDom(e)}))),e.parent(".list-group-item").find("small.children-count").first().text(n.length),0==n.length&&e.html('<div class="text-center p-4">No assets found</div>')})).catch((function(e){l.toast(e.message||"Unknown Error",5,"text-danger"),console.error(e)})),c.off("selectFolder",i),c.on("selectFolder",i)},t.fetchAssets=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=c.endpoints.fetch;return new Promise((function(n,o){var i=function(e){for(var t=null,n=c.assets,o=(e||"").split("/").filter((function(e){return""!==e})),a=0;a<o.length;a++){var i=o[a];if(!n[i])break;a===o.length-1?t=n[i]:n=n[i].children}return t}("/"==e?"/content":e);if(i&&i.children&&Object.keys(i.children).length>0&&!0!==i.invalid){var r=Object.keys(i.children).map((function(e){return i.children[e]}));n(r)}else if(null!=i&&i.invalid&&delete i.invalid,t){var d=new FormData;d.append("folder",e),c.config.extensions&&Object.keys(c.config.extensions).forEach((function(e){d.append("extensions[".concat(e,"]"),c.config.extensions[e])})),l.http.post(t,d).then((function(e){var t=e.data||[];(function(e){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw r}}}}(e);try{for(n.s();!(t=n.n()).done;){var o=t.value,i=(o.path||"").split("/").filter((function(e){return""!==e}));if(i.length>1)for(var r=c.assets,l=0;l<i.length;l++){var d=i[l];r[d]||(r[d]={path:i.slice(0,l+1).join("/"),children:{}}),l===i.length-1?r[d]=s(s({},{children:{}}),o):r=r[d].children}}}catch(e){n.e(e)}finally{n.f()}})(t),n(t)})).catch((function(e){o(e)}))}else o("No fetchURL set")}))},t.createAssetDom=function(e){return c.off("delete:".concat(e.path),h),c.on("delete:".concat(e.path),h),c.off("rename:".concat(e.path),f),c.on("rename:".concat(e.path),f),"folder"==e.type&&(c.off("newFolder:".concat(e.path),g),c.on("newFolder:".concat(e.path),g)),$('<li class="list-group-item file-asset'.concat(e.time>Math.floor(Date.now()/1e3)-10?" bg-primary bg-opacity-10":"",'" id="').concat(r(e),'">')).css({cursor:"pointer",background:"transparent",userSelect:"none",wordWrap:"anywhere"}).append($('<div class="d-flex w-100 justify-content-start align-items-center position-relative">').append($('<div class="asset-icon w-100" style="max-width: 45px;height: 30px; display: flex;justify-content: center;align-items: center; overflow: hidden;">').append("image"==e.type?$('<img src="'.concat(e.path,'" class="img-fluid" style="object-fit: cover;"></div>')):n[e.type])).append($('<div class="ms-2 me-1 asset-name">').append($('<h5 class="mb-0">'.concat(e.name,"</h5>")).append("folder"==e.type?$('<small class="text-muted text-thin ms-1 position-absolute top-0 children-count">'.concat(e.children_count,"</small>")).css({fontSize:"0.65em"}):""))).append("folder"==e.type?$('<i class="fa-solid fa-angle-down ms-auto"></i>'):"").on("click",(function(){if($("#filemanager-context-menu").remove(),"folder"==e.type){c.config.enable_select_folder&&(c.selectedFolder=e,c.fire("selectFolder",e));var n=$(this).parent(".list-group-item").find("#collapse-".concat(r(e)));n.toggleClass("show"),n.hasClass("show")?($(this).find(".fa-angle-down").removeClass("fa-angle-down").addClass("fa-angle-up"),t.renderAsset($(this).parent(".list-group-item").find(".collapse"),e.path)):$(this).find(".fa-angle-up").removeClass("fa-angle-up").addClass("fa-angle-down")}else c.config.enable_view&&c.AssetView.show(e)})),"folder"==e.type?$('<div class="collapse py-2 list-group list-group-flush" id="collapse-'.concat(r(e),'"></div>')):"").on("contextmenu",(function(t){t.preventDefault(),t.stopPropagation(),u(t,e)}))},c.on("newFolder:/",(function(e,n,o){console.log(n,o),d("/content",{name:o,path:n.path.replace(/\/$/,"")+"/"+o+"/",type:"folder",children_count:0,time:Date.now()})&&t.renderAsset($("#FileManagerModal").find("#assets-content"),"/")}))})),c.on("property:AssetView",(function(e,t){t.show=function(e){var t={video:function(t){0==$(document.head).find("link#video-js").length&&$(document.head).append('<link id="video-js" href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet">'),$.when($.getScript("https://vjs.zencdn.net/8.10.0/video.min.js")).done((function(){t.el.find(".asset-view").empty().append($("<video class='video-js position-absolute w-100 h-100 object-fit-contain' controls preload='auto' id='video'></video>").attr("src",e.path)),window.videojs("video",{controls:!0,controlBar:{pictureInPictureToggle:!1}}),t.on("modal:hide",(function e(){try{window.videojs("video").dispose()}catch(e){}t.off("modal:hide",e)}))}))},audio:function(e){},image:function(t){t.el.find(".asset-view").empty().append($("<img class='w-100 h-100 object-fit-contain' src='"+e.path+"' />"))},pdf:function(t){$.when($.getScript("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js")).done((function(){var n=window.pdfjsLib,o=$('<div class="page-container" style="max-height: 65vh; overflow: auto;"></div>').append("<canvas class='d-none'></canvas>");t.el.find(".asset-view").empty().append(o),n.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js";var a=window.location.origin+e.path;n.getDocument(a).promise.then((function(e){for(var t=function(){var t=document.createElement("div");t.className="page-container",o.append(t),e.getPage(n).then((function(e){var n=document.createElement("canvas"),o=n.getContext("2d");t.appendChild(n);var a=e.getViewport({scale:2});n.width=a.width,n.height=a.height,$(n).css({width:"100%"}),e.render({canvasContext:o,viewport:a})}))},n=1;n<=e.numPages;n++)t();$(".loding-container").remove()}))}))}},n=$('<div class="ratio ratio-16x9 asset-view" style="max-height: 65vh; height: 100%;overflow: hidden;"></div><small class="text-muted text-semibold text-break">'.concat(e.path,"</small>")),o=$("#FileManagerModal_AssetView").length>0?l.modal.from($("#FileManagerModal_AssetView")):l.modal.create("FileManagerModal_AssetView",n);if(o.el.prop("id","FileManagerModal_AssetView"),o.el.find(".modal-footer").empty(),o.el.find(".modal-title").text(e.name),o.el.find(".modal-dialog").css({maxWidth:"1024px"}),o.el.find(".modal-body").css({maxWidth:"1024px"}),o.el.find(".asset-view").empty().append($("<div class='w-100 h-100 d-flex justify-content-center align-items-center'>").append($("<i class='fa-solid fa-spinner fa-pulse fa-lg'></i>"),$("<span class='ms-2'>Loading...</span>"))),o.show(),$(o.el).find(".modal-footer").empty().addClass("p-3").append(c.is_pick?$('<button type="button" class="btn btn-primary ms-2">Select</button>').on("click",(function(){c.fire("asset:select",e),o.el.remove()})):""),t[e.type])t[e.type](o);else{if(/\.pdf$/i.test(e.name))return void t.pdf(o);$(o.el).find(".asset-view").empty().append('<div class="object-container"><object data="'.concat(e.path,'" type="text/html" width="100%" height="100%"></object></div>'))}}})),c.is_pick=!1,c.select=function(){return c.is_pick=!0,new Promise((function(e,t){function n(t,n){c.is_pick=!1,e(n)}c.off("asset:select",n),c.on("asset:select",n),c.Modal.show()}))}})()})();