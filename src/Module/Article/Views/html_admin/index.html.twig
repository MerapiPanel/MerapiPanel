{% extends "@admin::panel/base.html.twig" %}
{% block header_title %}Content{% endblock %}

{% block head_javascripts %}
<script src="{{ '@template/assets/dist/index.bundle.js' | assets }}"></script>
{% endblock %}

{% block subheader_actions %}
<div class="ms-auto">
    <a href="{{ 'article/create' | admin_url }}"
        class="ms-3 bg-white rounded outline-none border shadow px-4 py-2 hover:bg-blue-500 hover:text-white">
        <i class="fa fa-plus"></i> new article
    </a>
    <a href="{{ 'article/config' | admin_url }}"
        class="ms-3 bg-white rounded outline-none border shadow px-4 py-2 hover:bg-blue-500 hover:text-white">
        <svg class="inline-block" viewBox="0 0 536.41 506.22" width="16" height="16" fill="currentColor"
            xmlns="http://www.w3.org/2000/svg">
            <path
                d="m192.41 0c-39.8 0-72 32.2-72 72v137.27c.10467-.00019.20779-.006.3125-.006 9.5714 0 18.945.79233 28.055 2.3106 6.0729.99014 10.693 5.7431 12.014 11.75l7.6191 34.801v-186.12c0-13.3 10.7-24 24-24h272c13.3 0 24 10.7 24 24v304c0 13.3-10.7 24-24 24h-212.66l23.105 21.023c4.5547 4.0926 6.3369 10.497 4.2246 16.24-1.3497 3.6503-2.8417 7.2221-4.4414 10.736h189.77c39.8 0 72-32.2 72-72v-304c0-39.8-32.2-72-72-72zm-144 56c-13.3 0-24 10.7-24 24v191.83l18.949 6.0234c8.8453-6.799 18.615-12.477 29.045-16.768l.0059-.0273v-181.05c0-13.3-10.7-24-24-24zm176 24c-13.3 0-24 10.7-24 24v80c0 13.3 10.7 24 24 24h96c13.3 0 24-10.7 24-24v-80c0-13.3-10.7-24-24-24zm176 0c-13.3 0-24 10.7-24 24s10.7 24 24 24h32c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 80c-13.3 0-24 10.7-24 24s10.7 24 24 24h32c13.3 0 24-10.7 24-24s-10.7-24-24-24zm-176 80c-13.3 0-24 10.7-24 24 0 4.3988 1.2568 8.4572 3.3047 11.994l31.139-9.8945c5.8088-1.8483 12.279-.1984 16.174 4.4883 4.5546 5.5104 8.7506 11.327 12.594 17.412h168.79c13.3 0 24-10.7 24-24s-10.7-24-24-24zm54.887 80c1.6953 5.541-.0845 11.561-4.4394 15.475l-28.584 26.008c.28479 2.1489.47487 4.3318.6543 6.5176h185.48c13.3 0 24-10.7 24-24s-10.7-24-24-24z" />
            <path
                d="m240.46 333.62c1.5973 4.3426.24958 9.1844-3.1946 12.279l-21.613 19.667c.54906 4.143.84856 8.3857.84856 12.678s-.2995 8.5355-.84856 12.678l21.613 19.667c3.4442 3.0947 4.7919 7.9365 3.1946 12.279-2.1963 5.9399-4.8418 11.63-7.8866 17.121l-2.346 4.0431c-3.2944 5.4907-6.9881 10.682-11.031 15.574-2.945 3.5939-7.8367 4.7918-12.229 3.3942l-27.803-8.835c-6.6886 5.1413-14.076 9.434-21.963 12.678l-6.2394 28.502c-.9983 4.5423-4.4924 8.1362-9.0846 8.8849-6.8883 1.148-13.976 1.747-21.214 1.747-7.2377 0-14.326-.59899-21.214-1.747-4.5922-.74873-8.0862-4.3426-9.0846-8.8849l-6.2394-28.502c-7.8866-3.2445-15.274-7.5372-21.963-12.678l-27.753 8.8849c-4.3925 1.3976-9.2842.14974-12.229-3.3942-4.0431-4.8917-7.7368-10.083-11.031-15.574l-2.346-4.0431c-3.0448-5.4906-5.6903-11.181-7.8866-17.121-1.5973-4.3426-.24957-9.1844 3.1946-12.279l21.613-19.667c-.54906-4.1929-.84856-8.4357-.84856-12.728s.29949-8.5355.84856-12.678l-21.613-19.667c-3.4441-3.0947-4.7918-7.9365-3.1946-12.279 2.1963-5.9399 4.8418-11.63 7.8866-17.121l2.346-4.0431c3.2944-5.4906 6.9881-10.682 11.031-15.574 2.945-3.5939 7.8367-4.7919 12.229-3.3942l27.803 8.835c6.6886-5.1412 14.076-9.434 21.963-12.678l6.2394-28.502c.99829-4.5423 4.4924-8.1362 9.0846-8.8849 6.8883-1.198 13.976-1.797 21.214-1.797s14.326.599 21.214 1.747c4.5922.74872 8.0863 4.3426 9.0846 8.8849l6.2394 28.502c7.8866 3.2445 15.274 7.5372 21.963 12.678l27.803-8.835c4.3925-1.3976 9.2842-.14975 12.229 3.3942 4.0431 4.8917 7.7369 10.083 11.031 15.574l2.346 4.0431c3.0448 5.4907 5.6903 11.181 7.8866 17.121zm-119.75 84.556a39.932 39.932 0 100-79.864 39.932 39.932 0 100 79.864z" />
        </svg> config
    </a>
</div>
{% endblock %}


{% set articles = admin.article_fetchAll %}
{% set categories = admin.article_category.fetchAll %}

{% block breadcrumb %}
<nav class="flex w-full" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ '/' | admin_url }}">Home</a></li>
        <li class="breadcrumb-item">Article</li>
    </ol>
</nav>
{% endblock %}

{% block content %}

{{ articles |json_encode | raw }}


<div class="w-full flex relative">
    <div class="flex-1"></div>

    <div class="absolute md:relative top-0 -right-[15px] w-full max-w-[250px] px-2">
        <h3 class="text-lg bg-slate-200 px-1 mb-3 flex items-center w-full">
             <a class="ms-2 text-sm hover:text-blue-400" href="{{ '/article/category' | admin_url }}"><span class="font-semibold">Category</span> <i class="text-blue-400 text-[12px] align-baseline fa-solid fa-arrow-up-long rotate-45"></i></a>
            <button onclick="createNewCategory()" class="btn !p-1 ms-auto !shadow-none hover:text-blue-400">
                <i class="text-[14px] fa-solid fa-plus"></i>
            </button>
        </h3>
        <ul class="px-1 list-inside list-disc" id="categories">
            {% for category in categories %}
            <li class="pl-1 mb-2">{{ category.name }}</li>
            {% endfor %}
        </ul>
    </div>
</div>
<div class="inline-flex  max-w-[175px]"></div>

{% endblock %}
{% block javascript %}
{{ parent() }}
<script>


    function createNewCategory() {
        let container = $("#categories");

        let element = $(`<li class="pl-1 mb-2 whitespace-nowrap">
            <div class="inline-flex">
                <input class='px-2 py-1 outline-none max-w-[175px] rounded pt-1 px-2' type='text' name='category_name' placeholder='Category Name' pattern='[a-z]' invalid-message="Please enter category name" required>
                <button class="btn btn-sm ms-auto !px-3 hover:text-blue-400"><i class="fa-regular fa-circle-check"></i></button>
            </div>
        </li>`);

        container.append(element);
        element.find("input").trigger("focus");
        element.find("button").on("click", () => {
            let input = element.find("input");

            if (!input.validate()) {
                merapi.toast("Category name cannot be empty", 5, "text-danger");
                input.trigger("focus");
                return;
            }

            merapi.http.post("{{ '/article/endpoint/category/create' | admin_url }}", { name: input.val() }).then((data) => {
                console.log(data);
            })

        })
        setTimeout(() => {
            $(document).on("click", (e) => {
                if (!$(e.target).closest(element).length) {
                    element.remove();
                }
            })
        }, 200)
    }

</script>
{% endblock %}